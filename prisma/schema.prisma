generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

enum Model {
  User
  Role
  Post
  Category
  Tag
}

enum Lang {
    EN
    DV
}

enum UserStatus {
  active
  blocked
}

enum Action {
  draft
  publish
  soft_delete
  delete
  create
  update
}

enum Status {
  drafted
  published
  soft_deleted
  pending
}

model Country {
  id BigInt @id @default(autoincrement())

  name   String
  states State[] @relation("country")
}

model State {
  id        BigInt      @id @default(autoincrement())
  countryId BigInt?     @unique
  country   Country? @relation("country", fields: [countryId], references: [id], onDelete: Cascade)

  name   String
  cities City[] @relation("state")
}

model City {
  id      BigInt    @id @default(autoincrement())
  stateId BigInt?   @unique
  state   State? @relation("state", fields: [stateId], references: [id], onDelete: Cascade)

  name String
}

model User {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("usersCreated", fields: [createdById], references: [id], onDelete: SetNull)

  userName          String     @unique
  email             String     @unique
  password          String
  description       String
  status            UserStatus @default(active)
  profilePictureUrl String?       
  profilePicture    Media?     @relation("profilePicture", fields: [profilePictureUrl], references: [url], onDelete: SetNull)
  roleId            BigInt?       
  role              Role?      @relation("roleUsers", fields: [roleId], references: [id], onDelete: SetNull)

  logs                 Log[]      @relation("logs")
  usersCreated         User[]     @relation("usersCreated")
  rolesCreated         Role[]     @relation("rolesCreated")
  mediasCreated        Media[]    @relation("mediasCreated")
  libraryGroupsCreated Library[]  @relation("libraryCreated")
  postsCreated         Post[]     @relation("postsCreated")
  photosCreated        Photo[]    @relation("photosCreated")
  graphicsCreated      Graphic[]  @relation("graphicsCreated")
  videosCreated        Video[]   @relation("videosCreated")
  categoriesCreated    Category[] @relation("categoriesCreated")
  tagsCreated          Tag[]      @relation("tagsCreated")
}

model Role {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("rolesCreated", fields: [createdById], references: [id], onDelete: SetNull)

  name        String @unique
  permissions Json

  users User[] @relation("roleUsers")
}

model Log {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("logs", fields: [createdById], references: [id], onDelete: SetNull)

  action       Action
  model        Model
  previousData Json?
  newData      Json?
}

model Media {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("mediasCreated", fields: [createdById], references: [id], onDelete: SetNull)

  posts      Post[] @relation("postFeatureImage")
  photos     Photo[] @relation("photoFeatureImage")
  graphics   Graphic[] @relation("graphics")
  user       User[] @relation("profilePicture")
  mediasTags MediasTags[] @relation("mediasTags")

  url         String     @unique
  name        String

  libraryGroupId BigInt?
  libraryGroup   Library? @relation("libraryGroup", fields: [libraryGroupId], references: [id], onDelete: SetNull)
}

model Library {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("libraryCreated", fields: [createdById], references: [id], onDelete: SetNull)

  name        String  @unique
  description String
  medias      Media[] @relation("libraryGroup")
}

model Post {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("postsCreated", fields: [createdById], references: [id], onDelete: SetNull)

  categoryId          BigInt?
  category            Category? @relation("postsCategory", fields: [categoryId], references: [id], onDelete: Cascade)
  featureImageUrl     String?
  featureImage        Media?    @relation("postFeatureImage", fields: [featureImageUrl], references: [url], onDelete: SetNull)
  featureImageCaption String?

  title       String
  longTitle   String?
  latinTitle  String?
  description String?
  lead        String?
  breaking    Boolean?
  liveblog    Boolean?
  language    Lang @default(EN)
  status      Status @default(drafted)

  postsTags PostsTags[] @relation("postsTags")
}

model Category {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("categoriesCreated", fields: [createdById], references: [id], onDelete: SetNull)

  name        String
  slug        String @unique
  description String?
  icon        String?
  language    Lang @default(EN)

  posts Post[] @relation("postsCategory")
}

model Tag {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("tagsCreated", fields: [createdById], references: [id], onDelete: SetNull)

  name        String
  slug        String @unique

  tagsPosts  PostsTags[] @relation("tagsPosts")
  tagsMedias MediasTags[] @relation("tagsMedias")
}

model PostsTags {
  id     BigInt   @id @default(autoincrement())
  postId BigInt
  post   Post? @relation("postsTags", fields: [postId], references: [id], onDelete: Cascade)
  tagId  BigInt
  tag    Tag?  @relation("tagsPosts", fields: [tagId], references: [id], onDelete: Cascade)
}

model MediasTags {
  id      BigInt   @id @default(autoincrement())
  mediaId BigInt
  media   Media? @relation("mediasTags", fields: [mediaId], references: [id], onDelete: Cascade)
  tagId   BigInt
  tag     Tag?  @relation("tagsMedias", fields: [tagId], references: [id], onDelete: Cascade)
}

model Photo {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("photosCreated", fields: [createdById], references: [id], onDelete: SetNull)

  featureImageUrl String?
  featureImage    Media?    @relation("photoFeatureImage", fields: [featureImageUrl], references: [url], onDelete: SetNull)

  title       String
  longTitle   String?
  latinTitle  String?
  description String?
  lead        String?
  language    Lang @default(EN)
  status      Status @default(drafted)
}

model Graphic {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("graphicsCreated", fields: [createdById], references: [id], onDelete: SetNull)

  graphicsUrl String?
  graphics    Media?    @relation("graphics", fields: [graphicsUrl], references: [url], onDelete: SetNull)

  title       String
  longTitle   String?
  latinTitle  String?
  description String?
  language    Lang @default(EN)
  status      Status @default(drafted)
}

model Video {
  id          BigInt      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt?
  createdBy   User?    @relation("videosCreated", fields: [createdById], references: [id], onDelete: SetNull)

  YoutubeUrl String?

  title       String
  longTitle   String?
  latinTitle  String?
  description String?
  language    Lang @default(EN)
  status      Status @default(drafted)
}